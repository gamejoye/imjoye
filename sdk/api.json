{
  "openapi": "3.0.0",
  "paths": {
    "/users/{id}": {
      "get": {
        "operationId": "UsersController_getUserById",
        "summary": "根据userId获取用户信息",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取用户信息",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "未认证用户"
          }
        },
        "tags": [
          "users"
        ]
      }
    },
    "/users/{id}/friends": {
      "get": {
        "operationId": "UsersController_getFriendsById",
        "summary": "根据userId获取好友信息列表",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功根据userId获取好友信息列表",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "未认证用户"
          },
          "403": {
            "description": "权限不足"
          }
        },
        "tags": [
          "users"
        ]
      }
    },
    "/users/{id}/friends/{friendId}": {
      "get": {
        "operationId": "UsersController_getFriendInfoByUserIdAndFriendId",
        "summary": "获取好友信息",
        "parameters": [
          {
            "name": "id",
            "required": true,
            "in": "path",
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "friendId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取好友信息",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "未认证用户"
          },
          "403": {
            "description": "权限不足"
          }
        },
        "tags": [
          "users"
        ]
      }
    },
    "/users/avatar/upload": {
      "post": {
        "operationId": "UsersController_uploadAvatar",
        "summary": "上传头像",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "头像上传成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "413": {
            "description": "头像大小超过2MB"
          }
        },
        "tags": [
          "users"
        ]
      }
    },
    "/auth/login": {
      "post": {
        "operationId": "AuthController_login",
        "summary": "用户登录",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginUserRequestDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "登录成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "登录失败"
          }
        },
        "tags": [
          "auth"
        ]
      }
    },
    "/auth/register": {
      "post": {
        "operationId": "AuthController_register",
        "summary": "用户注册",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterUserRequestDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "注册成功",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "注册失败"
          },
          "409": {
            "description": "用户邮箱已经存在"
          }
        },
        "tags": [
          "auth"
        ]
      }
    },
    "/chatrooms/{chatroomId}/visit": {
      "put": {
        "operationId": "ChatroomsController_visitChatroom",
        "summary": "更新用户对于聊天室的最后访问时间",
        "parameters": [
          {
            "name": "timestamp",
            "required": true,
            "in": "query",
            "example": "2024-04-23 21:45",
            "description": "访问聊天室的最后时间戳",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "chatroomId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "number"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "成功更新用户访问聊天室的最后时间"
          },
          "404": {
            "description": "聊天室不存在或者无权访问"
          }
        },
        "tags": [
          "chatrooms"
        ]
      }
    },
    "/chatrooms/{chatroomId}": {
      "get": {
        "operationId": "ChatroomsController_getChatroom",
        "summary": "根据聊天室id获取单个聊天室",
        "parameters": [
          {
            "name": "chatroomId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取单个聊天室",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "未认证用户"
          },
          "404": {
            "description": "未找到聊天室"
          }
        },
        "tags": [
          "chatrooms"
        ]
      }
    },
    "/chatrooms": {
      "get": {
        "operationId": "ChatroomsController_getSingleChatroomByFriendId",
        "summary": "根据userId和friendId获取单个单聊聊天室",
        "parameters": [
          {
            "name": "friend_id",
            "required": true,
            "in": "query",
            "example": 2,
            "description": "好友id",
            "schema": {
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取单个单聊聊天室",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "未认证用户"
          },
          "404": {
            "description": "未找到聊天室"
          }
        },
        "tags": [
          "chatrooms"
        ]
      }
    },
    "/chatrooms/summaries/{chatroomId}": {
      "get": {
        "operationId": "ChatroomsController_getChatroomSummary",
        "parameters": [
          {
            "name": "chatroomId",
            "required": true,
            "in": "path",
            "schema": {
              "type": "number"
            }
          },
          {
            "name": "timestamp",
            "required": true,
            "in": "query",
            "example": "2024-04-23 21:45",
            "description": "最后一次访问聊天室的时间戳",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取单个聊天室的chatroomSummaries",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "未认证用户"
          }
        },
        "tags": [
          "chatrooms"
        ]
      }
    },
    "/chatrooms/summaries": {
      "post": {
        "operationId": "ChatroomsController_getChatroomSummaries",
        "summary": "获取聊天室信息概要",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GetChatroomSummariesDto"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "成功获取chatroomSummaries",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "未认证用户"
          }
        },
        "tags": [
          "chatrooms"
        ]
      }
    },
    "/messages": {
      "get": {
        "operationId": "MessagesController_getMessagesByChatroomId",
        "summary": "根据roomId获取消息",
        "parameters": [
          {
            "name": "room_id",
            "required": true,
            "in": "query",
            "example": 2,
            "description": "房间id",
            "schema": {
              "type": "number"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "成功获取聊天室消息",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "未认证用户"
          },
          "404": {
            "description": "聊天室不存在"
          }
        },
        "tags": [
          "messages"
        ]
      },
      "post": {
        "operationId": "MessagesController_addMessage",
        "summary": "在聊天室中发送消息",
        "parameters": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/IAddMessageDto"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "成功发送消息",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ApiResult"
                }
              }
            }
          },
          "401": {
            "description": "未认证用户"
          },
          "403": {
            "description": "无法在该聊天室发送消息"
          },
          "404": {
            "description": "资源不存在"
          }
        },
        "tags": [
          "messages"
        ]
      }
    }
  },
  "info": {
    "title": "IMJoye Api",
    "description": "[如有天樱花再开] 测试IMJoye Api",
    "version": "1.0",
    "contact": {}
  },
  "tags": [
    {
      "name": "Api/V1",
      "description": ""
    }
  ],
  "servers": [],
  "components": {
    "schemas": {
      "ApiResult": {
        "type": "object",
        "properties": {}
      },
      "LoginUserRequestDto": {
        "type": "object",
        "properties": {
          "email": {
            "type": "string",
            "example": "gamejoye@gmail.com",
            "description": "用户邮箱"
          },
          "password": {
            "type": "string",
            "example": "147jkl...",
            "description": "用户密码"
          }
        },
        "required": [
          "email",
          "password"
        ]
      },
      "RegisterUserRequestDto": {
        "type": "object",
        "properties": {
          "username": {
            "type": "string",
            "example": "gamejoye",
            "description": "用户名"
          },
          "email": {
            "type": "string",
            "example": "gamejoye@gmail.com",
            "description": "用户邮箱"
          },
          "password": {
            "type": "string",
            "example": "147jkl...",
            "description": "用户密码"
          },
          "avatarUrl": {
            "type": "string",
            "example": "https://gamejoye.top/static/media/bg.6885a3ed90df348b4f7a.jpeg",
            "description": "用户头像"
          }
        },
        "required": [
          "username",
          "email",
          "password",
          "avatarUrl"
        ]
      },
      "GetChatroomSummariesDto": {
        "type": "object",
        "properties": {
          "latestVisitTimes": {
            "example": [
              {
                "id": 11234889,
                "latestVisitTime": "2024-03-23 19:12"
              },
              {
                "id": 12481287,
                "latestVisitTime": "2024-03-21 14:55"
              }
            ],
            "description": "最后一次用户访问各个聊天室的信息",
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "required": [
          "latestVisitTimes"
        ]
      },
      "IAddMessageChatroomDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "number",
            "examples": [
              1,
              2,
              3,
              4,
              5
            ],
            "description": "待添加消息所属聊天室id"
          }
        },
        "required": [
          "id"
        ]
      },
      "IAddMessageFromDto": {
        "type": "object",
        "properties": {
          "id": {
            "type": "number",
            "examples": [
              7,
              8,
              9,
              10
            ],
            "description": "待添加消息发送者的id"
          }
        },
        "required": [
          "id"
        ]
      },
      "IAddMessageDto": {
        "type": "object",
        "properties": {
          "temporaryId": {
            "type": "number",
            "examples": [
              124,
              5125
            ],
            "description": "前端用于展示loading Message所需要使用的暂时id"
          },
          "chatroom": {
            "examples": [
              {
                "id": 7
              },
              {
                "id": 8
              },
              {
                "id": 9
              },
              {
                "id": 10
              }
            ],
            "description": "待添加消息所需要的chatroom的基本信息",
            "allOf": [
              {
                "$ref": "#/components/schemas/IAddMessageChatroomDto"
              }
            ]
          },
          "from": {
            "examples": [
              {
                "id": 1
              },
              {
                "id": 2
              },
              {
                "id": 3
              },
              {
                "id": 4
              },
              {
                "id": 5
              }
            ],
            "description": "待添加消息所需要的发送者的基本信息",
            "allOf": [
              {
                "$ref": "#/components/schemas/IAddMessageFromDto"
              }
            ]
          },
          "content": {
            "type": "string",
            "examples": [
              "如有天樱花再开",
              "无爱自是不能爱人"
            ],
            "description": "消息的内容"
          }
        },
        "required": [
          "temporaryId",
          "chatroom",
          "from",
          "content"
        ]
      }
    }
  }
}